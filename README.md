Todo: rework the way neighbours are checked.